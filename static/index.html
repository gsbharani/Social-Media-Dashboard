<!DOCTYPE html>
<html>
<head>
  <title>YouTube Analytics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Arial;padding:20px;background:#f4f6f8}
    .box{background:#fff;padding:15px;margin-bottom:20px;box-shadow:0 0 6px #ccc;border-radius:6px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid #ddd;padding:8px;font-size:14px}
    th{background:#eee}
    button{padding:6px 10px;margin:3px;cursor:pointer}
    .charts {display:grid; grid-template-columns:1fr; gap:20px; margin-top:20px;}
    @media(min-width:900px){.charts{grid-template-columns:repeat(3,1fr);}}
  </style>
</head>
<body>

<h2>ðŸ“Š YouTube Analytics Dashboard</h2>

<div class="box">
  <input id="query" placeholder="Keyword / Hashtag">
  <button onclick="loadSearch()">Search</button>
  <button onclick="setPreset(7)">Last 7 Days</button>
  <button onclick="setPreset(30)">Last 30 Days</button>
  <button onclick="loadTrending()">ðŸ”¥ Trending</button>
</div>

<div class="box charts">
  <canvas id="viewsChart"></canvas>
  <canvas id="likesChart"></canvas>
  <canvas id="commentsChart"></canvas>
</div>

<div class="box">
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Channel</th>
        <th>Date</th>
        <th>Views</th>
        <th>Likes</th>
        <th>Comments</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
let viewsChart, likesChart, commentsChart;

function setPreset(days){
  const end = new Date();
  const start = new Date();
  start.setDate(end.getDate()-days);
  const format = d=>d.toISOString().slice(0,10);
  document.getElementById("query").dataset.start = format(start);
  document.getElementById("query").dataset.end = format(end);
}

async function loadSearch(){
  const q = document.getElementById("query").value;
  const s = document.getElementById("query").dataset.start;
  const e = document.getElementById("query").dataset.end;
  if(!s || !e) setPreset(7);

  const r = await fetch(`/search?query=${q}&start=${s}&end=${e}`);
  const d = await r.json();
  renderCharts(d.videos);
  renderTable(d.videos);
}

async function loadTrending(){
  const r = await fetch("/trending");
  const d = await r.json();
  renderCharts(d.videos);
  renderTable(d.videos);
}

function renderTable(videos){
  const rows = document.getElementById("rows");
  rows.innerHTML="";
  videos.forEach(v=>{
    rows.innerHTML+=`
      <tr>
        <td>${v.title}</td>
        <td>${v.channel}</td>
        <td>${v.published}</td>
        <td>${v.views}</td>
        <td>${v.likes}</td>
        <td>${v.comments}</td>
        <td><a href="${v.url}" target="_blank">Open</a></td>
      </tr>
    `;
  });
}

function renderCharts(videos){
  const labels = videos.map(v=>v.published);
  const views = videos.map(v=>v.views);
  const likes = videos.map(v=>v.likes);
  const comments = videos.map(v=>v.comments);

  if(viewsChart) viewsChart.destroy();
  if(likesChart) likesChart.destroy();
  if(commentsChart) commentsChart.destroy();

  viewsChart = new Chart(document.getElementById("viewsChart"),{
    type:"line",
    data:{ labels, datasets:[{ label:"Views", data:views, borderColor:"blue", tension:0.3 }]},
    options:{responsive:true, plugins:{legend:{position:"top"}}, scales:{y:{beginAtZero:true}}}
  });

  likesChart = new Chart(document.getElementById("likesChart"),{
    type:"line",
    data:{ labels, datasets:[{ label:"Likes", data:likes, borderColor:"red", tension:0.3 }]},
    options:{responsive:true, plugins:{legend:{position:"top"}}, scales:{y:{beginAtZero:true}}}
  });

  commentsChart = new Chart(document.getElementById("commentsChart"),{
    type:"bar",
    data:{ labels, datasets:[{ label:"Comments", data:comments, backgroundColor:"green" }]},
    options:{responsive:true, plugins:{legend:{position:"top"}}, scales:{y:{beginAtZero:true}}}
  });
}
</script>

</body>
</html>
